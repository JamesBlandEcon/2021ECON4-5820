---
title: "Econometrics II Notes 20201"
author: "James Bland"
date: "Spring 2021"
output:
  bookdown::gitbook: default
---

```{r setup, include=FALSE}
library(ggplot2)
knitr::opts_chunk$set(echo = TRUE,warning = FALSE)
```

# Limited dependent variable models

## Some example data

```{r loadTirtanic}
library(dplyr)
D<-(data.frame(read.csv("https://vincentarelbundock.github.io/Rdatasets/csv/carData/TitanicSurvival.csv"))
)

DSummary<-D %>% group_by(sex,age,passengerClass) %>% summarize(fracSurvived = mean(1*(survived=="yes")),n=n())

knitr::kable(head(DSummary))
```

```{r PlotTitanic,cache=T}
library(ggplot2)
(ggplot(DSummary ,aes(y=fracSurvived,x=age,color=sex,shape=passengerClass,size=n))
  +geom_point()
 +theme_bw()
  +xlab("Age")
  +ylab("Fraction survived")
  +theme_bw()
)
```

## Analyzing with linear regression

```{r linreg, results="asis"}

D <- (D
  %>% mutate(adult = 1*(age>=18),
             class2 = 1*(passengerClass=="2nd"),
             class3 = 1*(passengerClass=="3rd"),
             male = 1*(sex=="male"),
             S = 1*(survived=="yes")
             )
)

reg1<-lm(S ~ age + sex+class2+class3,data=D)
reg2<-lm(S ~ age + adult+ sex+class2+class3,data=D)
reg3<-lm(S ~ age + adult +adult*male + sex + class2 + class3,data=D)


library(stargazer)
stargazer(reg1,reg2,reg3,type="html")

```

```{r PlotTitanicLinear,cache=T}

(ggplot(DSummary ,aes(y=fracSurvived,x=age,color=sex,shape=passengerClass,size=n))
  +geom_smooth(method="lm")
  +geom_point()
 +theme_bw()
  +xlab("Age")
  +ylab("Fraction survived")
  +theme_bw()
)
```

```{r TitanicMale}

(
  ggplot(data=(D %>% filter(sex=="male")), aes(x=age,y=factor(survived),group=paste(factor(age<18),passengerClass),color=passengerClass))
  +geom_point()
  +geom_smooth(method="lm")
  +theme_bw()
  +labs(title="Titanic survival (males only)")
)

```
